#include <stdio.h>
#include <stdlib.h>
#include <string.h> // strcpy, strlen, menset

#define MAX_PRODUCTS 100
#define MAX_NAME_LENGTH 30 //ë¬¸ìì—´ ê¸¸ì´ ì œí•œ, ëŒ€ì‹  string ì‚¬ìš©ê°€ëŠ¥

// ì œí’ˆ ë¶„ë¥˜ ì •ë³´
typedef struct {
    int id;
    int stock_qty;
    int sales_qty;
    char name[MAX_NAME_LENGTH];
} Product;

// IDë¡œ ìƒí’ˆ ì¸ë±ìŠ¤ë¥¼ ì°¾ëŠ” í•¨ìˆ˜
int find_product_index(Product products[], int count, int id) {
    for (int i = 0; i < count; i++) {
        if (products[i].id == id) {
            return i; // ì°¾ì•˜ì„ ê²½ìš° ì¸ë±ìŠ¤ ë°˜í™˜
        }
    }
    return -1; // ì°¾ì§€ ëª»í–ˆì„ ê²½ìš° -1 ë°˜í™˜
}

// ì¬ê³  ì¶”ê°€ í•¨ìˆ˜
void Add_stock(Product products[], int *count) {
    int id, stock_qty, price;
    char temp_name[MAX_NAME_LENGTH];
    
    // ìƒí’ˆ ID ì…ë ¥
    printf("ìƒí’ˆID: (ì…ë ¥) ");
    if (scanf("%d", &id) != 1) {
        printf("ì˜ëª»ëœ ì…ë ¥ì…ë‹ˆë‹¤. ì…ê³ ë¥¼ ì·¨ì†Œí•©ë‹ˆë‹¤.\n");
        return;
    }

    // ìƒí’ˆ IDë¡œ ê¸°ì¡´ ìƒí’ˆ ì—¬ë¶€ í™•ì¸
    int index = find_product_index(products, *count, id);

    // ------------------- 1. ê¸°ì¡´ ìƒí’ˆ ì—…ë°ì´íŠ¸ -------------------
    if (index != -1) {
        // ê¸°ì¡´ ìƒí’ˆì´ë¯€ë¡œ ìƒí’ˆëª…, íŒë§¤ê°€ê²© ì…ë ¥ì€ ê±´ë„ˆëœë‹ˆë‹¤.
        printf("ìƒí’ˆ ID %dëŠ” ê¸°ì¡´ ìƒí’ˆ(%s)ì…ë‹ˆë‹¤. ì¬ê³ ë§Œ ì¶”ê°€í•©ë‹ˆë‹¤. (í˜„ì¬ ì¬ê³ : %d)\n", 
               id, products[index].name, products[index].stock_qty);

        // ì…ê³ ëŸ‰ ì…ë ¥
        printf("ì…ê³ ëŸ‰: (ì…ë ¥) ");
        if (scanf("%d", &stock_qty) != 1) {
            printf("ì˜ëª»ëœ ì…ê³ ëŸ‰ ì…ë ¥. ì¬ê³  ì¶”ê°€ë¥¼ ì·¨ì†Œí•©ë‹ˆë‹¤.\n");
            return;
        }

        if (stock_qty <= 0) {
            printf("ì…ê³ ìˆ˜ëŸ‰ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤. (ì…ë ¥: %d)\n", stock_qty);
            return;
        }
        
        // ì¬ê³  ì—…ë°ì´íŠ¸
        products[index].stock_qty += stock_qty;
        printf("ìƒí’ˆ ID %dì— %dì˜ ì¬ê³ ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. (ì´ ì¬ê³ : %d)\n", 
               id, stock_qty, products[index].stock_qty);

    } 
    // ------------------- 2. ì‹ ê·œ ìƒí’ˆ ë“±ë¡ -------------------
    else {
        // ìƒí’ˆ ê°¯ìˆ˜ ì´ˆê³¼ ë©”ì‹œì§€ ì¶œë ¥ í™•ì¸
        if (*count >= MAX_PRODUCTS) {
            printf("ìƒí’ˆìˆ˜ì´ˆê³¼: ë” ì´ìƒ ìƒˆë¡œìš´ ìƒí’ˆì„ ì¶”ê°€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ìµœëŒ€ %dê°œ)\n", MAX_PRODUCTS);
            return;
        }

        printf("ğŸš¨ ìƒí’ˆ ID %dëŠ” ì‹ ê·œ ìƒí’ˆì…ë‹ˆë‹¤. ë“±ë¡ì„ ì‹œì‘í•©ë‹ˆë‹¤.\n", id);

        // 1. ìƒí’ˆëª… ì…ë ¥
        printf("ìƒí’ˆëª…: (ì…ë ¥) ìƒí’ˆëª… ì…ë ¥ ");
        // scanf("%s") ëŒ€ì‹  ì•ˆì „í•œ ë¬¸ìì—´ ì…ë ¥ì„ ìœ„í•´ ë²„í¼ ë¹„ìš°ê¸° ë° í˜•ì‹ ì§€ì •ì ì¡°ì • í•„ìš”
        if (scanf("%29s", temp_name) != 1) {  
            printf("ìƒí’ˆëª… ì…ë ¥ ì˜¤ë¥˜. ì‹ ê·œ ìƒí’ˆ ë“±ë¡ì„ ì·¨ì†Œí•©ë‹ˆë‹¤.\n");
            return;
        }
        
        // 2. ì…ê³ ëŸ‰ ì…ë ¥ (ì¬ê³  ì´ˆê¸°ê°’)
        printf("ì…ê³ ëŸ‰: (ì…ë ¥) ì…ê³ ìˆ˜ëŸ‰ ì…ë ¥ ");
        if (scanf("%d", &stock_qty) != 1) {
            printf("ì˜ëª»ëœ ì…ê³ ëŸ‰ ì…ë ¥. ì‹ ê·œ ìƒí’ˆ ë“±ë¡ì„ ì·¨ì†Œí•©ë‹ˆë‹¤.\n");
            return;
        }

        if (stock_qty <= 0) {
            printf("ì…ê³ ìˆ˜ëŸ‰ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤. ì‹ ê·œ ìƒí’ˆ ë“±ë¡ì„ ì·¨ì†Œí•©ë‹ˆë‹¤.\n");
            return;
        }

        // 3. íŒë§¤ê°€ê²© ì…ë ¥
        printf("íŒë§¤ê°€ê²©: (ì…ë ¥) íŒë§¤ê°€ê²© ì…ë ¥ ");
        if (scanf("%d", &price) != 1) {
            printf("ì˜ëª»ëœ íŒë§¤ê°€ê²© ì…ë ¥. ì‹ ê·œ ìƒí’ˆ ë“±ë¡ì„ ì·¨ì†Œí•©ë‹ˆë‹¤.\n");
            return;
        }

        if (price <= 0) {
            printf("íŒë§¤ê°€ê²©ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤. ì‹ ê·œ ìƒí’ˆ ë“±ë¡ì„ ì·¨ì†Œí•©ë‹ˆë‹¤.\n");
            return;
        }
        
        // ë°°ì—´ì˜ ë§ˆì§€ë§‰ì— ìƒˆ ìƒí’ˆ ì •ë³´ ì €ì¥
        products[*count].id = id;
        strcpy(products[*count].name, temp_name); // ìƒí’ˆ ì´ë¦„ ë³µì‚¬
        products[*count].stock_qty = stock_qty;
        products[*count].sales_qty = 0; // ì‹ ê·œ ìƒí’ˆì´ë¯€ë¡œ íŒë§¤ëŸ‰ì€ 0
        products[*count].price = price; // íŒë§¤ ê°€ê²© ì €ì¥
        
        (*count)++; // ì „ì²´ ìƒí’ˆ ê°œìˆ˜ 1 ì¦ê°€
        printf("ì‹ ê·œ ìƒí’ˆ ID %d ('%s')ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆê³ , %dì˜ ì¬ê³ ê°€ ì…ê³ ë˜ì—ˆìŠµë‹ˆë‹¤.\n", 
               id, temp_name, stock_qty);
    }
}

// íŒë§¤ ê¸°ë¡ í•¨ìˆ˜
void Record_sale(Product products[], int count) {
    int choice;
    printf("íŒë§¤(ì¶œë ¥)íŒë§¤ìˆ˜ëŸ‰ ì…ë ¥ : ì „ì²´ ìƒí’ˆ íŒë§¤ìˆ˜ëŸ‰ ì…ë ¥ 1, ê°œë³„ ìƒí’ˆ ì…ë ¥ 2 ë¥¼ ì„ íƒ\n");
    printf("> (ì…ë ¥) ");
    scanf("%d", &choice);

    if (choice == 1) {
        int total_sale;
        printf("ì „ì²´ íŒë§¤ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš” : ");
        scanf("%d", &total_sale);
        if (total_sale < 0) {
            printf("íŒë§¤ìˆ˜ëŸ‰ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.\n");
            return;
        }
        for (int i = 0; i < count; i++) {
            if (products[i].stock_qty >= total_sale) {
                products[i].stock_qty -= total_sale;
                products[i].sales_qty += total_sale;
            } else {
                printf("ìƒí’ˆ ID %dì˜ ì¬ê³ ê°€ ë¶€ì¡±í•˜ì—¬ íŒë§¤ë¥¼ ì™„ë£Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n", products[i].id);
            }
        }
        printf("ëª¨ë“  ìƒí’ˆì˜ íŒë§¤ê°€ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.\n");
    } else if (choice == 2) {
        int id, sales_qty;
        printf("(ì…ë ¥)ìƒí’ˆID : ");
        scanf("%d", &id);
        int index = find_product_index(products, count, id);
        if (index != -1) {
            printf("(ì…ë ¥)íŒë§¤ìˆ˜ëŸ‰ : ");
            scanf("%d", &sales_qty);
            if (sales_qty < 0) {
                printf("íŒë§¤ìˆ˜ëŸ‰ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.\n");
                return;
            }
            if (products[index].stock_qty >= sales_qty) {
                products[index].stock_qty -= sales_qty;
                products[index].sales_qty += sales_qty;
                printf("ìƒí’ˆ ID %dì— %dì˜ íŒë§¤ê°€ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.\n", id, sales_qty);
            } else {
                printf("ìƒí’ˆ ID %dì˜ ì¬ê³ (%d)ê°€ ë¶€ì¡±í•˜ì—¬ íŒë§¤ë¥¼ ì™„ë£Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n", id, products[index].stock_qty);
            }
        } else {
            printf("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìƒí’ˆ IDì…ë‹ˆë‹¤.\n");
        }
    } else {
        printf("ì˜ëª»ëœ ì„ íƒì…ë‹ˆë‹¤.\n");
    }
}

// ìƒí’ˆ ì¬ê³  ë° íŒë§¤ í˜„í™© í‘œì‹œ í•¨ìˆ˜
void Individual_status(Product products[], int count) {
    if (count == 0) {
        printf("í‘œì‹œí•  ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.\n");
        return;
    }

    int total_stock = 0;
    int total_sales = 0;
    
    int most_sold_index = 0; // ì²« ë²ˆì§¸ ìƒí’ˆì„ ìµœë‹¤ íŒë§¤ ìƒí’ˆìœ¼ë¡œ ê°€ì •í•˜ê³  ì‹œì‘
    int least_sold_index = 0; // ì²« ë²ˆì§¸ ìƒí’ˆì„ ìµœì†Œ íŒë§¤ ìƒí’ˆìœ¼ë¡œ ê°€ì •í•˜ê³  ì‹œì‘
    
    for (int i = 0; i < count; i++) {
        total_stock += products[i].stock_qty;
        total_sales += products[i].sales_qty;
        
        if (products[i].sales_qty > products[most_sold_index].sales_qty) {
            most_sold_index = i;
        }
        
        if (products[i].sales_qty < products[least_sold_index].sales_qty) {
            least_sold_index = i;
        }
    }
    
    // --- IDë³„ ì¬ê³  í˜„í™© ---
    printf("\n--- IDë³„ ì¬ê³  í˜„í™© ---\n");
    if (count == 0) {
        printf("ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.\n");
    } else {
        for (int i = 0; i < count; i++) {
            printf(" - ìƒí’ˆ ID %d : %dê°œ\n", products[i].id, products[i].stock_qty);
        }
    }
    printf("--------------------\n");
}

void Overall_status(Product products[], int count) {
    if (count == 0) {
        printf("í‘œì‹œí•  ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.\n");
        return;
    }

    int total_stock = 0;
    int total_sales = 0;
    
    int most_sold_index = 0; // ì²« ë²ˆì§¸ ìƒí’ˆì„ ìµœë‹¤ íŒë§¤ ìƒí’ˆìœ¼ë¡œ ê°€ì •í•˜ê³  ì‹œì‘
    int least_sold_index = 0; // ì²« ë²ˆì§¸ ìƒí’ˆì„ ìµœì†Œ íŒë§¤ ìƒí’ˆìœ¼ë¡œ ê°€ì •í•˜ê³  ì‹œì‘
    
    for (int i = 0; i < count; i++) {
        total_stock += products[i].stock_qty;
        total_sales += products[i].sales_qty;
        
        if (products[i].sales_qty > products[most_sold_index].sales_qty) {
            most_sold_index = i;
        }
        
        if (products[i].sales_qty < products[least_sold_index].sales_qty) {
            least_sold_index = i;
        }
    }
    
    printf("\n--- ìƒí’ˆ í˜„í™© ---\n");
    printf("ì´ ì¬ê³ ìˆ˜ëŸ‰ : %d\n", total_stock);
    printf("ì´ íŒë§¤ëŸ‰ : %d\n", total_sales);
    
    if (total_sales > 0) {
        printf("ê°€ì¥ ë§ì´ íŒë§¤ëœ ìƒí’ˆ : ID %d, íŒë§¤ëŸ‰ %d\n", 
               products[most_sold_index].id, products[most_sold_index].sales_qty);
        
        printf("ê°€ì¥ ì ê²Œ íŒë§¤ëœ ìƒí’ˆ : ID %d, íŒë§¤ëŸ‰ %d\n", 
               products[least_sold_index].id, products[least_sold_index].sales_qty);
    } else {
        printf("íŒë§¤ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.\n");
    }
    printf("----------------------\n");
}

int main() {
    Product products[MAX_PRODUCTS];
    int product_count = 0;
    int choice;

    // ì¸ë±ìŠ¤ ì´ˆê¸°í™”
    products[0] = (Product){1, 0, 0};   strcpy(products[0].name, "ìƒí’ˆëª… ë¯¸ë“±ë¡"); //strcpy ë¬¸ìì—´ ë³µì‚¬
    products[1] = (Product){2, 0, 0};   strcpy(products[1].name, "ìƒí’ˆëª… ë¯¸ë“±ë¡");
    products[2] = (Product){3, 0, 0};   strcpy(products[2].name, "ìƒí’ˆëª… ë¯¸ë“±ë¡");
    products[3] = (Product){4, 0, 0};   strcpy(products[3].name, "ìƒí’ˆëª… ë¯¸ë“±ë¡");
    products[4] = (Product){5, 0, 0};   strcpy(products[4].name, "ìƒí’ˆëª… ë¯¸ë“±ë¡");
    product_count = 5;

    do {
        printf("\nì›í•˜ëŠ” ë©”ë‰´ë¥¼ ì„ íƒí•˜ì„¸ìš”.(1. ì…ê³ , 2. íŒë§¤, 3. ê°œë³„í˜„í™©, 4. ì „ì²´í˜„í™©, 5. ì¢…ë£Œ)\n");
        printf("> ");
        scanf("%d", &choice);

        switch (choice) {
            case 1:
                Add_stock(products, &product_count);
                break;
            case 2:
                Record_sale(products, product_count);
                break;
            case 3:
                Individual_status(products, product_count);
                break;
            case 4:
                Overall_status(products, product_count);
                break;
            case 5:
                printf("í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.\n");
                break;
            default:
                printf("ì˜ëª»ëœ ì„ íƒì…ë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\n");
                break;
        }
    } while (choice != 4);

    return 0;
}
